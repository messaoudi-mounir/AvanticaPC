<?xml version="1.0" encoding="UTF-8"?>
<Flows xmlns="http://www.petrolink.com/mbe/rules">
  <Rule uuid="c1dea7e0-7510-11e6-bdf4-0800200c9a66UseCase0RLC" wellId="81549d90-7a99-11e6-bdf4-0800200c9a66" evaluationStrategy="RuleLevelCache" disableAt="2016-12-30T09:00:00">
    <Dependencies defaultType="LastKnownValue">
      <Channel alias="rop" scope="condition" id="5037f119-2d45-4106-a3c7-2fed671c1dcc"/>
      <Channel alias="other" scope="condition" id="c9f14a80-8c1e-11e6-bdf4-0800200c9a66"/>
    </Dependencies>
    <Variables>
      <Static alias="DRILLING" type="integer" scope="global" sequence="10">3</Static>
    </Variables>
    <FilteringCondition validateDependecyAvailability="true" />
    <Condition><![CDATA[(rop>15) && (other<50)]]></Condition>
    <RuleActions>
      <EvaluationLog testFileName="UseCase0-EVLog" sequence="10" name="action1" defaultMode="test">
      	<Channel id="aa76b54d-c963-4818-a69b-174352c9edf0"/>
      </EvaluationLog>
      <Script sequence="20">System.out.println("Use Case 0 Evaluation result was " + result + " at index " + index);
				System.out.println($rop.value);</Script>
    </RuleActions>
    <AlertSettings name="c1dea7e0-7510-11e6-bdf4-0800200c9a66UseCase0">
      <ProcessingLogic type="PetrolinkAutoClear" />
      <Template>
        <Domain>Y</Domain>
        <Classification>ClassMajor</Classification>
        <Severity>5</Severity>
        <Priority>3</Priority>
        <Description source="static">ROP is too High</Description>
        <Details contentType="json" source="context" />
      </Template>
      <Actions>
        <OnCreateActions>
			<SendUINotification sequence="10" defaultMode="test" testFileName="UseCase0-Notification">
				<Channel id="aa76b54d-c963-4818-a69b-174352c9abc0"/>
				<InlineTemplate>
					<Body>ROP: ${rop}</Body>
				</InlineTemplate>
			</SendUINotification>
          <SendMailNotification sequence="20" template="MailTemplate01">
            <To>user1@example.com,user2@example.com</To>
            <CC />
            <BCC>test@test.com</BCC>
            <Params>
              <Param name="subjectParam" type="String">Mailflow</Param>
              <Param name="p1" type="Integer">5</Param>
              <Param name="closing" type="String"><![CDATA[<p>
					Best Regards, <br/>
					<br/>
					Petrolink<br/>
					</p>]]></Param>
            </Params>
          </SendMailNotification>
          <Script sequence="30">System.out.println("I was here on Case 0!!");
						System.out.println("Index: " + details.get("index"));
						System.out.println("Value: " + details.get("value"));</Script>
        </OnCreateActions>
        <OnUpdateActions />
        <OnCommentActions />
        <OnAcknowledgeActions />
        <OnStatusChangeActions>
          <Switch sequence="10">
            <Case condition="alert.status == 1">
              <AlertAuditLog sequence="05" testFileName="UseCase0">
              	<Channel id="47248808-81bd-4142-ac8e-96441cf66357"/>
              </AlertAuditLog>
              <Script sequence="10">System.out.println("Alert with uuid " + alert.uuid + " was inactivated");</Script>
            </Case>
            <Case condition="alert.status == 2">
              <Script sequence="10">System.out.println("Alert with uuid " + alert.uuid + " was closed");</Script>
            </Case>
          </Switch>
        </OnStatusChangeActions>
      </Actions>
    </AlertSettings>
  </Rule>
</Flows>
