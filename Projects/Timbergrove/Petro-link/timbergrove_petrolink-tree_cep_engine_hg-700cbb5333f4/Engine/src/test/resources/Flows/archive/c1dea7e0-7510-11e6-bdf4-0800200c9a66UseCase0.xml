<?xml version="1.0" encoding="UTF-8"?>
<Flows xmlns="http://www.petrolink.com/mbe/rules">
  <Rule uuid="c1dea7e0-7510-11e6-bdf4-0800200c9a66UseCase0" well="81549d90-7a99-11e6-bdf4-0800200c9a66" evaluationStrategy="LastKnownValue" disableAt="2016-12-30T09:00:00" ruleId="c1dea7e0-7510-11e6-bdf4-0800200c9a66" ruleName="Use Case 0" wellName="Use Case 0 Well" rigName="Use Case 0 Rig">
    <Dependencies defaultType="LastKnownValue">
      <Channel alias="rop" type="lastknownvalue" scope="condition" valueUnit="ft/hr" indexUnit="datetime" id="5037f119-2d45-4106-a3c7-2fed671c1dcc" />
    </Dependencies>
    <Variables>
      <Static alias="DRILLING" type="integer" scope="global" sequence="10">3</Static>
    </Variables>
    <FilteringCondition />
    <Condition><![CDATA[(rop>15)]]></Condition>
    <RuleActions>
      <EvaluationLog sequence="10" name="action1" defaultMode="test" testFileName="UseCase0-EVLog">
        <Channel id="aa76b54d-c963-4818-a69b-174352c9edf0" />
      </EvaluationLog>
      <Script sequence="20">System.out.println("Use Case 0 Evaluation result was " + result + " at index " + index);
				System.out.println($rop.value);</Script>
    </RuleActions>
    <AlertSettings class="c1dea7e0-7510-11e6-bdf4-0800200c9a66" className="c1dea7e0-7510-11e6-bdf4-0800200c9a66UseCase0">
      <ProcessingLogic type="PetrolinkAutoClear" />
      <Template>
        <Domain>Y</Domain>
        <Classification>ClassMajor</Classification>
        <Severity>5</Severity>
        <Priority>3</Priority>
        <Description source="static">ROP is too High</Description>
        <Details contentType="json" source="context" />
		<Metadata contentType="json" source="script">
        	json.put("createdByRule", rule.getId());
        	json.put("wellId", rule.getWellId());
        </Metadata>
      </Template>
      <Actions>
        <OnCreateActions>
          <Script sequence="5">System.out.println("Use Case 0 executing on Create Actions");</Script>
          <SendUINotification sequence="10" defaultMode="test" testFileName="UseCase0-Notification">
            <Channel id="aa76b54d-c963-4818-a69b-174352c9abc0" />
            <InlineTemplate>
              <Title>ROP Alert</Title>
              <Body>ROP: ${rop.value} ${rop.valueUnit}</Body>
            </InlineTemplate>
          </SendUINotification>
          <!-- Originally from  template="MailTemplate01"-->
          <SendMailNotification sequence="20" template="7c18e624-e611-4e4f-b35f-f091a5138361">
            <To>user1@example.com,user2@example.com</To>
            <CC />
            <BCC>test@test.com</BCC>
            <Params>
              <Param name="subjectParam" type="String">Mailflow</Param>
              <Param name="p1" type="Integer">5</Param>
              <Param name="closing" type="String"><![CDATA[<p>
					Best Regards, <br/>
					<br/>
					Petrolink<br/>
					</p>]]></Param>
            </Params>
          </SendMailNotification>
          <Script sequence="30">System.out.println("I was here on Case 0!!");
						System.out.println("Index: " + details.get("index"));
						System.out.println("Value: " + details.get("value"));</Script>
        </OnCreateActions>
        <OnUpdateActions />
        <OnCommentActions />
        <OnAcknowledgeActions />
        <OnStatusChangeActions>
          <Switch sequence="10">
            <Case condition="alert.status == 1">
              <Script sequence="10">System.out.println("Alert with uuid " + alert.uuid + " was inactivated");</Script>
            </Case>
            <Case condition="alert.status == 2">
              <Script sequence="10">System.out.println("Alert with uuid " + alert.uuid + " was closed");</Script>
            </Case>
          </Switch>
        </OnStatusChangeActions>
        <OnJournalEntryActions>
          <EventLog sequence="10" testFileName="UseCase0-EventLog">
            <Channel id="47248808-81bd-4142-ac8e-96441cf66357" />
          </EventLog>
        </OnJournalEntryActions>
      </Actions>
    </AlertSettings>
  </Rule>
</Flows>
